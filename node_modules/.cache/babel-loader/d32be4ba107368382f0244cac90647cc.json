{"ast":null,"code":"import * as rp from \"request-promise\";\nimport * as cheerio from \"cheerio\";\nconst regex = /[^A-Za-z _-]/g;\nconst cardNameRegex = /[^A-Za-z /]/g;\nconst spaces = / /g;\nexport const getDecksFromUrl = wotcUrl => {\n  if (wotcUrl.startsWith(\"https://magic.wizards.com\")) {\n    const options = {\n      uri: `https://cors-anywhere.herokuapp.com/${wotcUrl}`,\n      headers: {\n        'Origin': 'https://feremiyjeenyus.github.io/mtgo-results-scraper/'\n      },\n      transform: function (body) {\n        return cheerio.load(body);\n      }\n    };\n    rp(options).then($ => {\n      const results = [];\n      const usernames = [];\n      $(\".deck-group\").each(function (i, elem) {\n        const headerContent = $(this).find(\"h4\").text();\n        const username = headerContent.split(\" (\")[0];\n        const parts = headerContent.split(\" (\");\n        const name = parts[0];\n        let chaff = \"\";\n\n        if (parts[1]) {\n          chaff = parts[1].replace(regex, \"\").replace(spaces, \"_\").toLowerCase();\n        }\n\n        const url = `${wotcUrl}#${name.replace(regex, \"\").replace(spaces, \"_\").toLowerCase()}${chaff ? \"_\" + chaff : \"\"}`;\n        const deck = {\n          maindeck: [],\n          sideboard: []\n        };\n        $(this).find(\".sorted-by-overview-container\").find(\".row\").each(function (i, elem) {\n          deck.maindeck.push({\n            name: $(this).find(\".card-name\").text().toUpperCase().trim().replace(cardNameRegex, \"\"),\n            count: parseInt($(this).find(\".card-count\").text(), 10)\n          });\n        });\n        const sideboardCards = {};\n        $(this).find(\".sorted-by-sideboard-container\").find(\".row\").each(function (i, elem) {\n          deck.sideboard.push({\n            name: $(this).find(\".card-name\").text().toUpperCase().trim().replace(cardNameRegex, \"\"),\n            count: parseInt($(this).find(\".card-count\").text(), 10)\n          });\n        });\n        results.push({\n          pilot: username,\n          url: url,\n          deck: deck\n        });\n      });\n      const markup = results.map(result => {\n        const link = wotcUrl.includes('events/coverage') ? `* [${result.pilot.replace(/[_]/g, \"\\\\_\").split(' - ')[1]}](${result.url}): **${result.pilot.replace(/[_]/g, \"\\\\_\").split(' - ')[0]}${usernames.includes(result.pilot) ? \" (duplicate pilot, link points to other list)\" : \"\"}**` : `* [archetype](${result.url}): **${result.pilot.replace(/[_]/g, \"\\\\_\")}${usernames.includes(result.pilot) ? \" (duplicate pilot, link points to other list)\" : \"\"}**`;\n        usernames.push(result.pilot);\n        return link;\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n    return results;\n  }\n};","map":{"version":3,"sources":["C:/Git/guided-scraper/src/scraper.ts"],"names":["rp","cheerio","regex","cardNameRegex","spaces","getDecksFromUrl","wotcUrl","startsWith","options","uri","headers","transform","body","load","then","$","results","usernames","each","i","elem","headerContent","find","text","username","split","parts","name","chaff","replace","toLowerCase","url","deck","maindeck","sideboard","push","toUpperCase","trim","count","parseInt","sideboardCards","pilot","markup","map","result","link","includes","catch","err","console","log"],"mappings":"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","sourcesContent":["import * as rp from \"request-promise\";\r\nimport * as cheerio from \"cheerio\";\r\n\r\nconst regex = /[^A-Za-z _-]/g;\r\nconst cardNameRegex = /[^A-Za-z /]/g;\r\nconst spaces = / /g;\r\n\r\nexport const getDecksFromUrl = (wotcUrl: string): Result[] => {\r\n    if (wotcUrl.startsWith(\"https://magic.wizards.com\")) {\r\n        const options = {\r\n            uri: `https://cors-anywhere.herokuapp.com/${wotcUrl}`,\r\n            headers: { 'Origin': 'https://feremiyjeenyus.github.io/mtgo-results-scraper/' },\r\n            transform: function (body: any) {\r\n                return cheerio.load(body);\r\n            }\r\n        };\r\n\r\n        rp(options)\r\n            .then($ => {\r\n                const results: Result[] = [];\r\n                const usernames: string[] = [];\r\n                $(\".deck-group\").each(function (i, elem) {\r\n                    const headerContent = $(this)\r\n                        .find(\"h4\")\r\n                        .text();\r\n                    const username = headerContent.split(\" (\")[0];\r\n                    const parts = headerContent.split(\" (\");\r\n                    const name = parts[0];\r\n                    let chaff = \"\";\r\n                    if (parts[1]) {\r\n                        chaff = parts[1]\r\n                            .replace(regex, \"\")\r\n                            .replace(spaces, \"_\")\r\n                            .toLowerCase();\r\n                    }\r\n                    const url = `${wotcUrl}#${name\r\n                        .replace(regex, \"\")\r\n                        .replace(spaces, \"_\")\r\n                        .toLowerCase()}${chaff ? \"_\" + chaff : \"\"}`;\r\n\r\n                    const deck: Deck = {\r\n                        maindeck: [],\r\n                        sideboard: []\r\n                    };\r\n                    $(this).find(\".sorted-by-overview-container\").find(\".row\").each(function (i, elem) {\r\n                        deck.maindeck.push(\r\n                            {\r\n                                name: $(this).find(\".card-name\").text().toUpperCase().trim().replace(cardNameRegex, \"\"),\r\n                                count: parseInt($(this).find(\".card-count\").text(), 10)\r\n                            }\r\n                        )\r\n                    })\r\n\r\n                    const sideboardCards = {};\r\n                    $(this).find(\".sorted-by-sideboard-container\").find(\".row\").each(function (i, elem) {\r\n                        deck.sideboard.push({\r\n                            name: $(this).find(\".card-name\").text().toUpperCase().trim().replace(cardNameRegex, \"\"),\r\n                            count: parseInt($(this).find(\".card-count\").text(), 10)\r\n                        })\r\n                    })\r\n\r\n                    results.push({\r\n                        pilot: username,\r\n                        url: url,\r\n                        deck: deck\r\n                    });\r\n                });\r\n\r\n                const markup = results.map(result => {\r\n                    const link = wotcUrl.includes('events/coverage') ? `* [${result.pilot.replace(/[_]/g, \"\\\\_\").split(' - ')[1]}](${result.url}): **${result.pilot.replace(/[_]/g, \"\\\\_\").split(' - ')[0]}${\r\n                        usernames.includes(result.pilot) ? \" (duplicate pilot, link points to other list)\" : \"\"\r\n                        }**` :\r\n                        `* [archetype](${result.url}): **${result.pilot.replace(/[_]/g, \"\\\\_\")}${\r\n                        usernames.includes(result.pilot) ? \" (duplicate pilot, link points to other list)\" : \"\"\r\n                        }**`;\r\n                    usernames.push(result.pilot);\r\n                    return link;\r\n                });\r\n            })\r\n            .catch(err => {\r\n                console.log(err);\r\n            });\r\n        return results\r\n    }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}