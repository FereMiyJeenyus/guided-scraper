{"ast":null,"code":"import rp from \"request-promise\";\nimport * as cheerio from \"cheerio\";\nconst regex = /[^A-Za-z _-]/g;\nconst cardNameRegex = /[^A-Za-z /]/g;\nconst spaces = / /g;\nexport const getDecksFromUrl = async wotcUrl => {\n  const results = [];\n\n  if (wotcUrl.startsWith(\"https://magic.wizards.com\")) {\n    const options = {\n      uri: `https://cors-anywhere.herokuapp.com/${wotcUrl}`,\n      headers: {\n        'Origin': 'https://feremiyjeenyus.github.io/mtgo-results-scraper/'\n      },\n      transform: function (body) {\n        return cheerio.load(body);\n      }\n    };\n    await rp(options).then($ => {\n      const usernames = [];\n      $(\".deck-group\").each(function () {\n        const headerContent = $(this).find(\"h4\").text();\n        const username = headerContent.split(\" (\")[0];\n        const duplicatePilot = usernames.includes(username);\n        usernames.push(username);\n        const parts = headerContent.split(\" (\");\n        const name = parts[0];\n        let chaff = \"\";\n\n        if (parts[1]) {\n          chaff = parts[1].replace(regex, \"\").replace(spaces, \"_\").toLowerCase();\n        }\n\n        const url = `${wotcUrl}#${name.replace(regex, \"\").replace(spaces, \"_\").toLowerCase()}${chaff ? \"_\" + chaff : \"\"}`;\n        const deck = {\n          maindeck: [],\n          sideboard: []\n        };\n        $(this).find(\".sorted-by-overview-container\").find(\".row\").each(function () {\n          deck.maindeck.push({\n            name: $(this).find(\".card-name\").text().trim(),\n            count: parseInt($(this).find(\".card-count\").text(), 10),\n            highlighted: false\n          });\n        });\n        $(this).find(\".sorted-by-sideboard-container\").find(\".row\").each(function () {\n          deck.sideboard.push({\n            name: $(this).find(\".card-name\").text().trim(),\n            count: parseInt($(this).find(\".card-count\").text(), 10),\n            highlighted: false\n          });\n        });\n        results.push({\n          pilot: username,\n          url: url,\n          deck: deck,\n          duplicatePilot,\n          archetype: \"\"\n        });\n      });\n    }).catch(err => {\n      console.log(err);\n      throw err;\n    });\n  }\n\n  return results;\n};","map":{"version":3,"sources":["C:/Git/guided-scraper/src/scraper.ts"],"names":["rp","cheerio","regex","cardNameRegex","spaces","getDecksFromUrl","wotcUrl","results","startsWith","options","uri","headers","transform","body","load","then","$","usernames","each","headerContent","find","text","username","split","duplicatePilot","includes","push","parts","name","chaff","replace","toLowerCase","url","deck","maindeck","sideboard","trim","count","parseInt","highlighted","pilot","archetype","catch","err","console","log"],"mappings":"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","sourcesContent":["import rp from \"request-promise\";\r\nimport * as cheerio from \"cheerio\";\r\nimport { Deck, Result } from './types'\r\n\r\nconst regex = /[^A-Za-z _-]/g;\r\nconst cardNameRegex = /[^A-Za-z /]/g;\r\nconst spaces = / /g;\r\n\r\nexport const getDecksFromUrl = async (wotcUrl: string): Promise<Result[]> => {\r\n    const results: Result[] = [];\r\n    if (wotcUrl.startsWith(\"https://magic.wizards.com\")) {\r\n        const options = {\r\n            uri: `https://cors-anywhere.herokuapp.com/${wotcUrl}`,\r\n            headers: { 'Origin': 'https://feremiyjeenyus.github.io/mtgo-results-scraper/' },\r\n            transform: function (body: string) {\r\n                return cheerio.load(body);\r\n            }\r\n        };\r\n        await rp(options)\r\n            .then($ => {\r\n                const usernames: string[] = [];\r\n                $(\".deck-group\").each(function (this: string) {\r\n                    const headerContent = $(this)\r\n                        .find(\"h4\")\r\n                        .text();\r\n                    const username = headerContent.split(\" (\")[0];\r\n                    const duplicatePilot = usernames.includes(username)\r\n                    usernames.push(username);\r\n                    const parts = headerContent.split(\" (\");\r\n                    const name = parts[0];\r\n                    let chaff = \"\";\r\n                    if (parts[1]) {\r\n                        chaff = parts[1]\r\n                            .replace(regex, \"\")\r\n                            .replace(spaces, \"_\")\r\n                            .toLowerCase();\r\n                    }\r\n                    const url = `${wotcUrl}#${name\r\n                        .replace(regex, \"\")\r\n                        .replace(spaces, \"_\")\r\n                        .toLowerCase()}${chaff ? \"_\" + chaff : \"\"}`;\r\n\r\n                    const deck: Deck = {\r\n                        maindeck: [],\r\n                        sideboard: []\r\n                    };\r\n                    $(this).find(\".sorted-by-overview-container\").find(\".row\").each(function (this: string) {\r\n                        deck.maindeck.push(\r\n                            {\r\n                                name: $(this).find(\".card-name\").text().trim(),\r\n                                count: parseInt($(this).find(\".card-count\").text(), 10),\r\n                                highlighted: false\r\n                            }\r\n                        )\r\n                    })\r\n\r\n                    $(this).find(\".sorted-by-sideboard-container\").find(\".row\").each(function (this: string) {\r\n                        deck.sideboard.push({\r\n                            name: $(this).find(\".card-name\").text().trim(),\r\n                            count: parseInt($(this).find(\".card-count\").text(), 10),\r\n                            highlighted: false\r\n                        })\r\n                    })\r\n\r\n                    results.push({\r\n                        pilot: username,\r\n                        url: url,\r\n                        deck: deck,\r\n                        duplicatePilot,\r\n                        archetype: \"\"\r\n                    });\r\n                });\r\n\r\n            })\r\n            .catch(err => {\r\n                console.log(err);\r\n                throw (err)\r\n            });\r\n    }\r\n    return results\r\n};\r\n"]},"metadata":{},"sourceType":"module"}